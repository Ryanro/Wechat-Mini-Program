global.webpackJsonp([10],{"+BQn":function(t,i){},CBaE:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("5nAL"),n=e.n(s),a=e("rlG1");new n.a(a.a).$mount(),i.default={config:{navigationBarTitleText:"编辑"}}},NNJ9:function(t,i,e){"use strict";var s=e("//Fk"),n=e.n(s),a=e("Xxa5"),o=e.n(a),c=e("exGp"),r=e.n(c),l=e("Dd8w"),u=e.n(l),d=e("NYxO"),h=e("5ybJ"),p=e("IcnI"),v=e("ZoQJ");i.a={components:{fab:h.a},store:p.a,data:function(){return{id:null}},computed:u()({},e.i(d.d)(["getPhotoById","photoEditable","wordCount","formData"]),e.i(d.a)({photo_url:function(t){return t.editing.photo_url},location:function(t){return t.editing.location},original:function(t){return t.editing.original}}),{description:{get:function(){return this.$store.state.editing.description},set:function(t){this.$store.commit("setDescription",t)}}}),onShow:function(){this.id=this.$root.$mp.query.id,!this.id||this.original&&this.id===this.original.id||this.setEditing(this.getPhotoById(this.id)),!this.id&&this.original&&this.clearEditing()},methods:u()({},e.i(d.b)(["fetchPhotos"]),e.i(d.e)(["setPhotoUrl","setLocation","clearEditing","setEditing"]),{chooseImage:function(){var t=this;return r()(o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=t,i.next=3,e.i(v.k)();case 3:i.t1=i.sent,i.t0.setPhotoUrl.call(i.t0,i.t1);case 5:case"end":return i.stop()}},i,t)}))()},chooseAddress:function(){var t=this;return r()(o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=t,i.next=3,e.i(v.j)();case 3:i.t1=i.sent,i.t0.setLocation.call(i.t0,i.t1);case 5:case"end":return i.stop()}},i,t)}))()},preview:function(){wx.previewImage({current:this.photo_url,urls:[this.photo_url]})},submit:function(){this.id?this.updatePhoto():this.createPhoto()},createPhoto:function(){var t=this;return r()(o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.photo_url){i.next=10;break}return i.next=3,e.i(v.d)("timeline",t.photo_url,t.formData);case 3:return wx.navigateBack(),e.i(v.h)("图片上传成功","success"),t.clearEditing(),i.next=8,t.fetchPhotos();case 8:i.next=11;break;case 10:e.i(v.h)("请选择需要上传的图片");case 11:case"end":return i.stop()}},i,t)}))()},updatePhoto:function(){var t=this;return r()(o.a.mark(function i(){var s;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(s=[],t.original.photo_url!==t.photo_url&&s.push(e.i(v.d)("timeline/"+t.id+"/photo",t.photo_url)),t.original.location===t.location&&t.original.description===t.description||s.push(e.i(v.a)("timeline/"+t.id+"/meta","PUT",{description:t.description,location:t.location})),!(s.length>0)){i.next=11;break}return wx.showLoading({title:"正在更新..."}),i.next=7,n.a.all(s);case 7:return t.clearEditing(),i.next=10,t.fetchPhotos();case 10:wx.hideLoading();case 11:wx.navigateBack();case 12:case"end":return i.stop()}},i,t)}))()}})}},QkJY:function(t,i,e){"use strict";var s={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"image-uploader"},[t.photo_url?e("img",{staticClass:"preview",attrs:{src:t.photo_url,mode:"aspectFill",eventid:"1"},on:{click:t.preview}}):e("div",{staticClass:"stripes",attrs:{eventid:"0"},on:{click:t.chooseImage}},[e("div",[t._v("点击上传照片")])]),t._v(" "),t.photoEditable?e("div",{staticClass:"fab-container",attrs:{eventid:"2"},on:{click:t.chooseImage}},[e("fab",{attrs:{icon:"/static/icons/upload.png",mpcomid:"0"}})],1):t._e()]),t._v(" "),e("div",{staticClass:"input-cells"},[e("div",{staticClass:"weui-cell weui-cell_access",attrs:{eventid:"3"},on:{click:t.chooseAddress}},[t._m(0),t._v(" "),e("div",{staticClass:"weui-cell__bd weui-cell_primary"},[e("div",{class:{empty:!t.location}},[t._v(t._s(t.location||"添加位置"))])]),t._v(" "),e("div",{staticClass:"weui-cell__ft weui-cell__ft_in-access"})]),t._v(" "),e("div",{staticClass:"weui-cell weui-cell_access"},[t._m(1),t._v(" "),t._m(2),t._v(" "),e("div",{staticClass:"weui-cell__ft"},[t._v(t._s(t.wordCount))])]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"text",attrs:{placeholder:"添加字幕","placeholder-class":"empty","cursor-spacing":0,"show-confirm-bar":!1,eventid:"4"},domProps:{value:t.description},on:{input:function(i){i.target.composing||(t.description=i.target.value)}}})]),t._v(" "),e("div",{staticClass:"submit-button",attrs:{eventid:"5"},on:{click:t.submit}},[e("img",{staticClass:"icon",attrs:{src:"/static/icons/submit.png"}}),t._v(" "),e("span",[t._v("发表")])])])},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"weui-cell__hd"},[i("img",{staticClass:"icon",attrs:{src:"/static/icons/locate.png"}})])},function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"weui-cell__hd"},[i("img",{staticClass:"icon",attrs:{src:"/static/icons/description.png"}})])},function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"weui-cell__bd weui-cell_primary"},[i("div",[this._v("简介")])])}]};i.a=s},rlG1:function(t,i,e){"use strict";var s=e("NNJ9"),n=e("QkJY");var a=function(t){e("+BQn")},o=e("ybqe")(s.a,n.a,a,"data-v-d2462d14",null);i.a=o.exports}},["CBaE"]);